!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("promise"),require("miniapp-auth"),require("mksign")):"function"==typeof define&&define.amd?define(["exports","promise","miniapp-auth","mksign"],n):(e=e||self,function(){var t=e["mini-auth-v1"],i=e["mini-auth-v1"]={};n(i,e.Promise,e.miniappAuth,e.mksign),i.noConflict=function(){return e["mini-auth-v1"]=t,i}}())}(this,function(e,n,t,i){"use strict";n=n&&n.hasOwnProperty("default")?n.default:n;var o=null;e.creatMiniAuth=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{env:"weapp"},n=e.appid,a=e.env,u=e.url,r=e.appKey,d=e.appCode,p=e.headers;return o||((o=t.miniAuth.create({appid:n,env:a,tokenReqConfig:{url:u,method:"POST",headers:p}})).use("token",function(e,n){var t=e.tokenReqData.jsCode;t&&("undefined"!=typeof wx&&wx&&(e.tokenReqData={js_code:t,sign:i.defaultSign({js_code:t,app_key:r},[d]),app_key:r}),"undefined"!=typeof my&&my&&(e.tokenReqData={auth_code:t,sign:i.defaultSign({auth_code:t,app_key:r},[d]),app_key:r})),n()}),o.use("afterToken",function(e,n){var t=e.tokenResData.data,i=t.data,o=void 0===i?{}:i,a=t.retcode,u=t.msg;return 200===a?(e.tokenResData=o,n()):n({retcode:a,msg:u,data:o})}),o)},e.getToken=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new n(function(n,t){!function i(a){o.getToken(e).then(function(e){n(e)}).catch(function(e){5001===e.errCode||5002===e.errCode?a>=3?t(e):setTimeout(function(){i(a+1)},2e3):t(e)})}(0)})},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=mini-auth-v1.common.js.map
