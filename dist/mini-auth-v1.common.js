!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("miniapp-auth"),require("mksign")):"function"==typeof define&&define.amd?define(["exports","miniapp-auth","mksign"],n):(e=e||self,function(){var t=e["mini-auth-v1"],i=e["mini-auth-v1"]={};n(i,e.miniappAuth,e.mksign),i.noConflict=function(){return e["mini-auth-v1"]=t,i}}())}(this,function(e,n,t){"use strict";var i=null;e.creatMiniAuth=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{env:"weapp"},o=e.appid,a=e.env,u=e.url,r=e.appKey,d=e.appSecret,p=e.headers;return i||((i=n.miniAuth.create({appid:o,env:a,headers:p,tokenReqConfig:{url:u,method:"POST"}})).use("token",function(e,n){var i=e.tokenReqData.jsCode;i&&("undefined"!=typeof wx&&wx&&(e.tokenReqData={js_code:i,sign:t.defaultSign({js_code:i,app_key:r},[d]),app_key:r}),"undefined"!=typeof my&&my&&(e.tokenReqData={auth_code:i,sign:t.defaultSign({auth_code:i,app_key:r},[d]),app_key:r})),n()}),i.use("afterToken",function(e,n){var t=e.tokenResData.data,i=t.data,o=void 0===i?{}:i,a=t.retcode,u=t.msg;return 200===a?(e.tokenResData=o,n()):n({retcode:a,msg:u,data:o})}),i)},e.getToken=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(n,t){!function o(a){i.getToken(e).then(function(e){n(e)}).catch(function(e){5001===e.errCode||5002===e.errCode?a>=3?t(e):setTimeout(function(){o(a+1)},2e3):t(e)})}(0)})},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=mini-auth-v1.common.js.map
